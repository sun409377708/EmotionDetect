# ☁️ 表情识别服务云部署指南

## 🎯 概述

本项目支持多种云平台部署，让您的表情识别服务可以在线访问。

## 📋 部署前准备

### 文件清单
- ✅ `web_demo.py` - Flask应用主文件
- ✅ `best_emotion_model.h5` - 训练好的模型（8MB）
- ✅ `requirements.txt` - Python依赖
- ✅ `templates/index.html` - Web界面
- ✅ `Procfile` - Heroku配置
- ✅ `runtime.txt` - Python版本
- ✅ `vercel.json` - Vercel配置
- ✅ `app.yaml` - Google Cloud配置

### 注意事项
⚠️ **模型文件大小**: `best_emotion_model.h5` 约8MB，部分平台可能有文件大小限制
⚠️ **内存需求**: TensorFlow模型加载需要较大内存，建议选择至少512MB内存的实例

---

## 🚀 部署方案

### 方案1：Heroku部署（推荐免费用户）

#### 步骤1：准备Heroku账户
1. 注册 https://heroku.com
2. 安装 Heroku CLI

#### 步骤2：创建应用
```bash
# 登录Heroku
heroku login

# 创建应用（替换your-app-name为您的应用名）
heroku create your-emotion-app

# 设置Git远程仓库
heroku git:remote -a your-emotion-app
```

#### 步骤3：部署
```bash
# 推送代码
git push heroku main

# 查看日志
heroku logs --tail
```

#### 步骤4：访问
应用将在 `https://your-emotion-app.herokuapp.com` 可用

---

### 方案2：Vercel部署（推荐）

#### 特点
- ✅ 免费额度充足
- ✅ 自动从GitHub部署
- ✅ 全球CDN加速
- ⚠️ 函数执行时间限制（30秒）

#### 步骤1：连接GitHub
1. 访问 https://vercel.com
2. 使用GitHub账户登录
3. 导入您的 `EmotionDetect` 仓库

#### 步骤2：配置部署
Vercel会自动检测到 `vercel.json` 配置文件

#### 步骤3：访问
部署完成后，Vercel会提供一个 `.vercel.app` 域名

---

### 方案3：Railway部署

#### 特点
- ✅ 现代化界面
- ✅ 自动从GitHub部署
- ✅ 免费额度：每月500小时
- ✅ 支持大文件

#### 步骤1：连接GitHub
1. 访问 https://railway.app
2. 连接GitHub仓库

#### 步骤2：自动部署
Railway会自动检测Python项目并部署

---

### 方案4：Google Cloud Platform

#### 步骤1：创建项目
```bash
# 安装gcloud CLI
# 创建新项目
gcloud projects create your-emotion-project

# 设置项目
gcloud config set project your-emotion-project
```

#### 步骤2：部署
```bash
# 部署到App Engine
gcloud app deploy app.yaml
```

---

## ⚙️ 环境配置

### 环境变量
```bash
# 生产环境
FLASK_ENV=production
PORT=8080  # 由平台自动设置
```

### 资源需求
- **内存**: 最少512MB，推荐1GB
- **CPU**: 最少1个vCPU
- **存储**: 约50MB（包含模型文件）

---

## 🔧 故障排除

### 常见问题

#### 1. 模型加载失败
```
❌ 模型加载失败: No such file or directory
```
**解决方案**: 确保 `best_emotion_model.h5` 文件在项目根目录

#### 2. 内存不足
```
❌ Killed (OOM)
```
**解决方案**: 升级到更大内存的实例类型

#### 3. 依赖安装失败
```
❌ Could not install packages due to an EnvironmentError
```
**解决方案**: 检查 `requirements.txt` 中的版本兼容性

#### 4. 启动超时
```
❌ Application startup timeout
```
**解决方案**: 
- 增加启动超时时间
- 使用更轻量的模型格式（TFLite）

### 优化建议

#### 1. 使用TFLite模型
如果遇到内存问题，可以修改代码使用TFLite模型：
```python
# 在web_demo.py中替换模型加载代码
import tensorflow as tf

def load_model():
    global model
    try:
        interpreter = tf.lite.Interpreter(model_path="emotion_model.tflite")
        interpreter.allocate_tensors()
        model = interpreter
        print("✅ TFLite模型加载成功")
        return True
    except Exception as e:
        print(f"❌ 模型加载失败: {e}")
        return False
```

#### 2. 减少冷启动时间
- 使用模型预热
- 选择支持持久存储的平台

#### 3. 添加健康检查
```python
@app.route('/health')
def health_check():
    return {'status': 'healthy', 'model_loaded': model is not None}
```

---

## 📊 平台对比

| 平台 | 免费额度 | 内存限制 | 启动速度 | 推荐指数 |
|------|----------|----------|----------|----------|
| Heroku | 550小时/月 | 512MB | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| Vercel | 100GB/月 | 1GB | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Railway | 500小时/月 | 8GB | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| GCP | $300试用 | 可配置 | ⭐⭐⭐ | ⭐⭐⭐ |

---

## 🎉 部署成功验证

部署成功后，访问您的应用URL，应该能看到：
1. ✅ 表情识别Web界面正常显示
2. ✅ 可以上传图片
3. ✅ AI能正确识别表情并返回结果

---

## 📞 获取帮助

如果遇到部署问题，可以：
1. 查看平台的部署日志
2. 检查 `requirements.txt` 依赖版本
3. 确认模型文件是否正确上传
4. 尝试使用更轻量的TFLite模型

**提示**: 推荐首先尝试 **Railway** 或 **Vercel**，它们对新手最友好！ 